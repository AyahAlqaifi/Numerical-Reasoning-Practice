<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Spatial Visualisation Practice (GIA-style)</title>
  <style>
    :root{
      --bg:#f6f7fb; --card:#ffffff; --ink:#1f2937; --muted:#6b7280;
      --accent:#0ea5e9; --accent-dark:#0369a1; --good:#16a34a; --bad:#ef4444;
      --outer-pad:16px;            /* page padding */
      --answers-h:68px;            /* fixed answers bar height */
      --answers-gap:12px;          /* gap around answers bar */
      --container-max:960px;
    }
    *{box-sizing:border-box}
    html,body{height:100%; overflow:hidden;}
    body{
      margin:0; font-family:ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background:var(--bg); color:var(--ink);
    }

    /* Small back button (top-left) */
    .back-mini{
      position:fixed; top:12px; left:12px; z-index:6;
      width:40px; height:40px; display:inline-flex; align-items:center; justify-content:center;
      border-radius:10px; border:1px solid #e5e7eb; background:#fff; cursor:pointer; line-height:1;
      font-size:18px; user-select:none;
    }
    .back-mini:hover{background:#f9fafb}

    /* Main container takes full viewport height, with room for the fixed answers bar */
    .container{
      height:100dvh; max-height:100dvh;
      width:100%; max-width:var(--container-max);
      margin:0 auto; background:var(--card);
      border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,.08);
      padding:var(--outer-pad);
      padding-bottom:calc(var(--outer-pad) + var(--answers-h) + var(--answers-gap));
      display:grid; grid-template-rows:auto auto 1fr; gap:12px; overflow:hidden;
    }

    h1{margin:0; font-size:clamp(1.2rem, 1rem + 1.2vw, 1.8rem)}
    .lead{margin:2px 0 8px; color:var(--muted); font-size:0.98rem}

    /* Controls (hidden after Start) */
    .controls{display:grid; grid-template-columns:1fr 1fr auto auto; gap:10px}
    select, button{
      width:100%; padding:10px 12px; border-radius:10px; border:1px solid #e5e7eb;
      font-size:1rem; background:#fff; color:var(--ink);
    }
    .primary{background:var(--accent); color:#fff; border:none; cursor:pointer}
    .primary:hover{background:var(--accent-dark)}
    .ghost{background:#fff}
    .hidden{display:none !important}

    /* HUD */
    .topbar{display:flex; gap:10px; align-items:center; justify-content:space-between}
    .stat{background:#f1f5f9; padding:8px 12px; border-radius:999px; font-size:.95rem; color:#0f172a; white-space:nowrap}

    /* Question area uses remaining space (no scrolling) */
    #questionArea{
      min-height:0; overflow:hidden;
      display:grid; grid-template-columns:1fr 1fr; gap:12px;
    }
    .pairCard{
      min-height:0; overflow:hidden;
      border:1px dashed #d1d5db; border-radius:14px; padding:12px; background:#fafafa;
      display:flex; flex-direction:column;
    }
    .pairTitle{font-weight:600; color:#475569; margin-bottom:8px}
    .pairCanvas{
      min-height:0; flex:1 1 auto;
      display:grid; grid-template-rows:1fr 1fr; gap:10px;
    }

    /* Shape boxes fill available height; SVG scales inside */
    .shapeBox{
      min-height:0; overflow:hidden;
      display:flex; align-items:center; justify-content:center;
      background:#fff; border:1px solid #e5e7eb; border-radius:10px;
    }
    .shapeBox .svg{width:88%; height:88%}

    /* Fixed answers bar (always visible) */
    .answers{
      position:fixed; left:50%; transform:translateX(-50%);
      bottom:var(--answers-gap);
      width:calc(100% - var(--answers-gap)*2);
      max-width:var(--container-max);
      background:#fff; border:1px solid #e5e7eb; border-radius:14px;
      box-shadow:0 12px 30px rgba(0,0,0,.12);
      padding:10px; z-index:5;
      display:grid; grid-template-columns:repeat(3,1fr); gap:10px;
      height:var(--answers-h); align-items:center;
    }
    .answers button{
      padding:14px 10px; font-size:1.1rem; border-radius:10px; border:1px solid #e5e7eb; background:#fff; cursor:pointer;
    }
    .answers button:hover{background:#f3f4f6}
    .answers button.correct{background:var(--good); color:#fff; border-color:transparent}
    .answers button.wrong{background:var(--bad); color:#fff; border-color:transparent}

    .footer{color:var(--muted); font-size:.9rem}

    /* Mobile tweaks */
    @media (max-width: 760px){
      .controls{grid-template-columns:1fr 1fr; grid-auto-rows:auto}
      :root{ --answers-h:76px; }
      #questionArea{grid-template-columns:1fr}
      .container{border-radius:0}
    }
  </style>
</head>
<body>

  <!-- Small back button -->
  <button class="back-mini" onclick="window.location.href='index.html'" aria-label="Back to Menu">←</button>

  <div class="container">
    <header>
      <h1>Spatial Visualisation – Practice</h1>
      <p class="lead">How many <strong>pairs</strong> below contain the <em>same</em> symbol (rotation allowed, mirror image ≠ same)? Choose 0, 1 or 2.</p>
    </header>

    <!-- Controls: HIDE after Start -->
    <div class="controls" id="controls">
      <select id="difficulty" aria-label="Select difficulty">
        <option value="">Select difficulty</option>
        <option value="easy">Easy (20s/q)</option>
        <option value="medium">Medium (15s/q)</option>
        <option value="hard">Hard (7s/q)</option>
      </select>
      <select id="questionCount" aria-label="Select number of questions">
        <option value="12">12 questions</option>
        <option value="20">20 questions</option>
        <option value="30" selected>30 questions</option>
      </select>
      <button id="start" class="primary">Start</button>
      <button id="retry" class="ghost hidden">Retry</button>
    </div>

    <!-- HUD -->
    <div class="topbar hidden" id="hud">
      <div class="stat" id="progress">Q 1/30</div>
      <div class="stat" id="timer">⏱ 15s</div>
      <div class="stat" id="score">Score: 0</div>
    </div>

    <!-- Question Area -->
    <main id="questionArea" class="hidden" aria-live="polite">
      <section class="pairCard">
        <div class="pairTitle">Box A</div>
        <div class="pairCanvas">
          <div class="shapeBox"><svg class="svg" viewBox="-60 -60 120 120" role="img" aria-label="Top symbol in Box A"></svg></div>
          <div class="shapeBox"><svg class="svg" viewBox="-60 -60 120 120" role="img" aria-label="Bottom symbol in Box A"></svg></div>
        </div>
      </section>
      <section class="pairCard">
        <div class="pairTitle">Box B</div>
        <div class="pairCanvas">
          <div class="shapeBox"><svg class="svg" viewBox="-60 -60 120 120" role="img" aria-label="Top symbol in Box B"></svg></div>
          <div class="shapeBox"><svg class="svg" viewBox="-60 -60 120 120" role="img" aria-label="Bottom symbol in Box B"></svg></div>
        </div>
      </section>
    </main>

    <p class="footer">Tip: Keyboard shortcuts 0/1/2 to answer. Rotation allowed, mirror image does <em>not</em> count as the same.</p>
  </div>

  <!-- Fixed Answers Bar -->
  <div class="answers hidden" id="answers" role="radiogroup" aria-label="How many pairs match?">
    <button data-val="0" role="radio" aria-checked="false">0</button>
    <button data-val="1" role="radio" aria-checked="false">1</button>
    <button data-val="2" role="radio" aria-checked="false">2</button>
  </div>

  <script>
    /* ---------- Shapes (asymmetric so mirrors differ) ---------- */
    const BASE_SHAPES = [
      { id: 'L', path: 'M -30 -40 L 10 -40 L 10 -30 L -20 -30 L -20 40 L -30 40 Z' },
      { id: 'F', path: 'M -25 -40 L -5 -40 L -5 40 L -25 40 Z M -5 -25 L 25 -25 L 25 -10 L -5 -10 Z M -5 5 L 15 5 L 15 20 L -5 20 Z' },
      { id: 'HOOK', path: 'M -30 -35 L 0 -35 L 0 -20 L -15 -20 L -15 35 L -30 35 Z M 0 -35 L 25 -35 L 25 -20 L 0 -20 Z' },
      { id: 'ZIG', path: 'M -30 -25 L 10 -25 L 10 -10 L -5 -10 L 25 25 L -15 25 L -15 10 L 0 10 Z' }
    ];
    const ROTATIONS = [0, 90, 180, 270];
    const rand = arr => arr[Math.floor(Math.random() * arr.length)];

    function makeSymbol(svg, baseShape, mirrored=false, rotation=0){
      svg.innerHTML = '';
      const g = document.createElementNS('http://www.w3.org/2000/svg','g');
      const p = document.createElementNS('http://www.w3.org/2000/svg','path');
      p.setAttribute('d', baseShape.path);
      p.setAttribute('fill', '#111827');
      p.setAttribute('fill-opacity', '0.9');
      const scaleX = mirrored ? -1 : 1;
      g.setAttribute('transform', `scale(${scaleX},1) rotate(${rotation})`);
      g.appendChild(p);
      svg.appendChild(g);
    }

    function buildPair(){
      const shape = rand(BASE_SHAPES);
      const isSame = Math.random() < 0.5;
      const mirroredTop = Math.random() < 0.5;
      const mirroredBottom = isSame ? mirroredTop : !mirroredTop;
      const rotTop = rand(ROTATIONS);
      let rotBottom = rand(ROTATIONS);
      if(rotBottom === rotTop) rotBottom = rand(ROTATIONS);
      return { shape, mirroredTop, mirroredBottom, rotTop, rotBottom, isSame };
    }

    function renderPair(pair, svgTop, svgBottom){
      makeSymbol(svgTop, pair.shape, pair.mirroredTop, pair.rotTop);
      makeSymbol(svgBottom, pair.shape, pair.mirroredBottom, pair.rotBottom);
    }

    /* ---------- Quiz state ---------- */
    let totalQ = 30, difficulty = 'medium', timePer = 15;  // default text shows 15s
    let idx = 0, score = 0, timer = null, timeLeft = 0, locked=false;

    const el = s => document.querySelector(s);
    const els = s => Array.from(document.querySelectorAll(s));

    function setDifficulty(d){
      difficulty = d || 'medium';
      // Times: easy=20, medium=15, hard=7
      timePer = (difficulty==='easy')?20:(difficulty==='hard'?7:15);
      el('#timer').textContent = `⏱ ${String(timePer).padStart(2,'0')}s`;
    }

    function start(){
      const d = el('#difficulty').value;
      if(!d){ alert('Please select a difficulty'); return; }
      setDifficulty(d);
      totalQ = parseInt(el('#questionCount').value,10) || 30;
      idx = 0; score = 0; updateHUD();

      // Hide setup, show game UI
      el('#controls').classList.add('hidden');
      el('#hud').classList.remove('hidden');
      el('#questionArea').classList.remove('hidden');
      el('#answers').classList.remove('hidden');

      nextQuestion();
    }

    function updateHUD(){
      el('#progress').textContent = `Q ${Math.min(idx+1, totalQ)}/${totalQ}`;
      el('#score').textContent = `Score: ${score}`;
    }

    function renderQuestion(){
      const pairA = buildPair();
      const pairB = buildPair();
      const matchCount = (pairA.isSame?1:0) + (pairB.isSame?1:0);
      const svgs = els('.pairCard .svg');
      renderPair(pairA, svgs[0], svgs[1]);
      renderPair(pairB, svgs[2], svgs[3]);
      el('#answers').dataset.correct = String(matchCount);
    }

    function nextQuestion(){
      locked = false;
      renderQuestion();
      updateHUD();
      startTimer();
    }

    function startTimer(){
      clearInterval(timer); timeLeft = timePer; updateTimerText();
      timer = setInterval(()=>{
        timeLeft--; updateTimerText();
        if(timeLeft<=0){ clearInterval(timer); autoAnswer(); }
      }, 1000);
    }
    function updateTimerText(){ el('#timer').textContent = `⏱ ${String(Math.max(timeLeft,0)).padStart(2,'0')}s`; }

    function lockAndScore(selected){
      if(locked) return; locked = true; clearInterval(timer);
      const correct = el('#answers').dataset.correct;
      els('#answers button').forEach(b=>{
        if(b.dataset.val===correct) b.classList.add('correct');
      });
      if(selected){
        if(selected.dataset.val===correct){ score++; selected.classList.add('correct'); }
        else selected.classList.add('wrong');
      }
      updateHUD();
      setTimeout(()=>{
        els('#answers button').forEach(b=>{ b.classList.remove('correct','wrong'); });
        idx++;
        if(idx>=totalQ) endQuiz(); else nextQuestion();
      }, 850);
    }

    function autoAnswer(){ lockAndScore(null); }

    function endQuiz(){
      el('#questionArea').classList.add('hidden');
      const pct = Math.round((score/totalQ)*100);
      el('#progress').textContent = `Finished`;
      el('#timer').textContent = `Result`;
      el('#score').textContent = `Score: ${score}/${totalQ} (${pct}%)`;
      el('#retry').classList.remove('hidden');
    }

    /* ---------- Events ---------- */
    el('#start').addEventListener('click', start);
    el('#retry').addEventListener('click', ()=>window.location.reload());
    els('#answers button').forEach(btn=>btn.addEventListener('click', ()=> lockAndScore(btn)));
    document.addEventListener('keydown', (e)=>{
      if(['0','1','2'].includes(e.key)){
        const btn = els('#answers button').find(b=>b.dataset.val===e.key);
        if(btn && !el('#answers').classList.contains('hidden')) lockAndScore(btn);
      }
    });
  </script>
</body>
</html>
